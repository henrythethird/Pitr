{% import "macros/tags.macro.html.twig" as tags %}

<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>{% block title %}Welcome!{% endblock %}</title>
        {% block stylesheets %}
            <link rel="stylesheet" href="{{ asset('css/bootstrap.min.css') }}" />
            <link rel="stylesheet" href="{{ asset('css/base.css') }}" />
        {% endblock %}

        <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />
    </head>
    <body>
        <nav class="navbar navbar-default navbar-static-top">
            <div class="row">
                <div class="col-xs-2">
                    <a class="navbar-brand" href="{{ path('homepage') }}">Pitr</a>
                </div>
                <div class="col-xs-10" style="padding-top: 8px;">
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">
                            <i class="glyphicon glyphicon-search"></i>
                        </span>
                        <input class="form-control" type="search" oninput="fetchCenter()" id="search_term" placeholder="Enter your serach term" />
                    </div>
                </div>
            </div>
        </nav>
        <div class="container-fluid">
            <div class="row">
                <div class="col-xs-2">
                    {{ render(controller("AppBundle:Default:navigation")) }}
                </div>
                <div class="col-xs-10" id="js-center-region">
                    {% block body %}{% endblock %}
                </div>
            </div>
        </div>
        {% block javascripts %}
            <script type="text/javascript" src="{{ asset('js/jquery.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('js/bootstrap.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('js/dropzone.js') }}"></script>
            <script type="text/javascript">
                var global_tag_id = null;
                var currentRequest = null;
                var currentTimeout = null;

                function fetchCenter(skipWait, tag_id) {
                    var center = $('#js-center-region');
                    var search_bar = $('#search_term');

                    //center.html('');

                    if (!tag_id) {
                        tag_id = global_tag_id;
                    } else {
                        global_tag_id = tag_id;
                    }

                    if (currentRequest) {
                        currentRequest.abort();
                    }

                    if (currentTimeout) {
                        clearTimeout(currentTimeout);
                    }

                    currentTimeout = setTimeout(function() {
                        currentRequest = $.get('{{ path('filtered_homepage') }}', {
                            'tag_id': tag_id,
                            'search_term': search_bar.val()
                        }, function(data) {
                            center.html(data);
                        });
                    }, !skipWait ? 500 : 0);
                }
            </script>
        {% endblock %}
    </body>
</html>
